{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block content %}
<div class="container d-flex align-items-center justify-content-center min-vh-100">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card-group">
                <div class="card p-4" style="width: 70%; height: auto;">
                    <div class="card-body">
                        <h2 class="text-center">Sign-Up</h2>
                        <p class="text-center">Please, use the following form to register:</p>
                        <div class="progress mb-4">
                            <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;"
                                aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <form id="registrationForm" method="post" class="needs-validation" novalidate>
                            {% csrf_token %}
                            {{ user_form.non_field_errors }}

                            <!-- Step 1: User Details -->
                            <div id="step1" class="step">
                                <div class="mb-3">
                                    {{ user_form.first_name }}
                                    <div class="invalid-feedback">
                                        Please enter your first name.
                                    </div>
                                </div>
                                <div class="mb-3">
                                    {{ user_form.middle_name }}
                                </div>
                                <div class="mb-3">
                                    {{ user_form.last_name }}
                                    <div class="invalid-feedback">
                                        Please enter your last name.
                                    </div>
                                </div>
                                <div class="mb-3">
                                    {{ user_form.contact_no }}
                                </div>
                                <div class="mb-3" class="was-validated">
                                    {{ user_form.email }}
                                    <div class="invalid-feedback" id="emailInvalidFeedback">
<<<<<<< HEAD
                                        Please enter a vailid email-id.
=======
                                        Please enter a valid email-id.
>>>>>>> 34753366547cb490da32fec25d38354c3827bc88
                                    </div>
                                </div>
                                <div class="mb-3">
                                    {{ user_form.password }}
<<<<<<< HEAD
                                    <div class="invalid-feedback">
                                        Please enter a password.
=======
                                    <div class="invalid-feedback" id="passwordInvalidFeedback" style="width: 300px;">
                                        Password must be at least 8 characters long, contain letters, numbers, and at least one special character.
>>>>>>> 34753366547cb490da32fec25d38354c3827bc88
                                    </div>
                                </div>
                                <div class="mb-3">
                                    {{ user_form.password2 }}
                                    <div class="invalid-feedback" id="passwordMismatchFeedback">
                                        Passwords don't match.
                                    </div>
                                </div>
<<<<<<< HEAD
=======
                                <div class="mb-3">
                                    <input type="checkbox" id="promotions" name="promotions">
                                    <label for="promotions">I want to receive promotions and updates</label>
                                </div>
>>>>>>> 34753366547cb490da32fec25d38354c3827bc88
                                <button type="button" class="btn btn-primary w-100 mt-3" id="nextButton"
                                    onclick="nextStep(2)" disabled>Next</button>
                            </div>

                            <!-- Step 2: Address -->
                            <div id="step2" class="step d-none">
                                <div class="mb-3">
                                    {{ address_form.billing_address }}
                                </div>
                                <div class="mb-3">
                                    {{ address_form.city }}
                                </div>
                                <div class="mb-3">
                                    {{ address_form.state }}
                                </div>
                                <div class="mb-3">
                                    {{ address_form.zip_code }}
                                </div>
                                <button type="button" class="btn btn-secondary w-100 mt-3"
                                    onclick="prevStep(1)">Back</button>
                                <button type="button" class="btn btn-primary w-100 mt-3"
                                    onclick="nextStep(3)">Next</button>
                            </div>

                            <!-- Step 3: Card Information -->
                            <div id="step3" class="step d-none">
                                <div class="mb-3">
                                    {{ card_form.card_number }}
                                </div>
                                <div class="mb-3">
                                    {{ card_form.expiry_date }}
                                </div>
                                <div class="mb-3">
                                    {{ card_form.cvv }}
                                </div>
                                <button type="button" class="btn btn-secondary w-100 mt-3"
                                    onclick="prevStep(2)">Back</button>
                                <button type="submit" class="btn btn-primary w-100 mt-3">Register</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="card text-white bg-primary py-5 d-md-down-none" style="width:30%">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <div>
                            <h2>Welcome Back!</h2>
                            <p>To keep connected with us please login with your personal info</p>
                        </div>
                        <a href="{% url 'user_login' %}" class="btn btn-outline-light">Login</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
        function updateProgressBar(step) {
        const progressBar = document.getElementById('progressBar');
        const stepPercentage = (step / 3) * 100; // Assuming 3 steps
        progressBar.style.width = stepPercentage + '%';
    }

    function nextStep(step) {
        if (validateStep(step - 1)) {
            document.getElementById('step' + (step - 1)).classList.add('d-none');
            document.getElementById('step' + step).classList.remove('d-none');
            updateProgressBar(step);
        }
    }

    function prevStep(step) {
        document.getElementById('step' + (step + 1)).classList.add('d-none');
        document.getElementById('step' + step).classList.remove('d-none');
        updateProgressBar(step);
    }

    function validateStep(step) {
        let valid = true;
        const stepDiv = document.getElementById('step' + step);
        const inputs = stepDiv.querySelectorAll('input[required]');
        inputs.forEach(input => {
            if (!input.value) {
                input.classList.add('is-invalid');
                valid = false;
            } else {
                input.classList.remove('is-invalid');
            }
        });
        return valid;
    }

<<<<<<< HEAD
    // Add this part for live password validation and button enable/disable

=======
>>>>>>> 34753366547cb490da32fec25d38354c3827bc88
    document.addEventListener("DOMContentLoaded", function () {
        const password = document.getElementById("password");
        const password2 = document.getElementById("password2");
        const nextButton = document.getElementById("nextButton");
        const passwordMismatchFeedback = document.getElementById("passwordMismatchFeedback");
<<<<<<< HEAD
=======
        const passwordInvalidFeedback = document.getElementById("passwordInvalidFeedback");
>>>>>>> 34753366547cb490da32fec25d38354c3827bc88
        const email = document.getElementById("email");
        const emailInvalidFeedback = document.getElementById("emailInvalidFeedback");

        function validatePasswords() {
<<<<<<< HEAD
            if (password.value !== password2.value) {
                password2.classList.add("is-invalid");
                passwordMismatchFeedback.style.display = "block";
                nextButton.disabled = true;
            } else {
                password2.classList.remove("is-invalid");
                passwordMismatchFeedback.style.display = "none";
                validateForm();
=======
            const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
            if (!passwordPattern.test(password.value)) {
                password.classList.add("is-invalid");
                passwordInvalidFeedback.style.display = "block";
                nextButton.disabled = true;
            } else {
                password.classList.remove("is-invalid");
                passwordInvalidFeedback.style.display = "none";
                if (password.value !== password2.value) {
                    password2.classList.add("is-invalid");
                    passwordMismatchFeedback.style.display = "block";
                    nextButton.disabled = true;
                } else {
                    password2.classList.remove("is-invalid");
                    passwordMismatchFeedback.style.display = "none";
                    validateForm();
                }
>>>>>>> 34753366547cb490da32fec25d38354c3827bc88
            }
        }

        function validateEmail() {
            const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!emailPattern.test(email.value)) {
                email.classList.add("is-invalid");
                emailInvalidFeedback.style.display = "block";
                nextButton.disabled = true;
            } else {
                email.classList.remove("is-invalid");
                emailInvalidFeedback.style.display = "none";
                validateForm();
            }
        }

        function validateForm() {
<<<<<<< HEAD
            if (password.value === password2.value && email.validity.valid) {
=======
            const requiredFields = document.querySelectorAll('#step1 input[required]');
            let allFilled = true;
            requiredFields.forEach(field => {
                if (!field.value) {
                    allFilled = false;
                }
            });

            const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
            const passwordValid = passwordPattern.test(password.value);

            if (password.value === password2.value && email.validity.valid && allFilled && passwordValid) {
>>>>>>> 34753366547cb490da32fec25d38354c3827bc88
                nextButton.disabled = false;
            } else {
                nextButton.disabled = true;
            }
        }

        password.addEventListener("input", validatePasswords);
        password2.addEventListener("input", validatePasswords);
        email.addEventListener("input", validateEmail);
<<<<<<< HEAD
    });

</script>
{% endblock %}
=======
        document.querySelectorAll('#step1 input[required]').forEach(field => {
            field.addEventListener('input', validateForm);
        });
    });
</script>

{% endblock %}




<!-- The issue is with the nextStep function not being defined before it is called. 
 Specifically, the nextStep function is called in the onclick attribute of the “Next” button, 
 but it was defined after the DOMContentLoaded event listener.

To fix this, we need to move the nextStep function definition above the
 DOMContentLoaded event listener. Here’s the corrected script:
 -->
>>>>>>> 34753366547cb490da32fec25d38354c3827bc88
